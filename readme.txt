エアコン with NatureRemo.alfredworkflowのメモ

機能：
NatureRemoのAPIを使ってエアコンを操作する

インストール：
  1.alfredworkflowをダウンロード
  2.ファイルをダブルクリックしてワークフローに登録
  3.NatureRemoのアクセス用トークンとエアコンのアプライアンスIDを入力し変数を設定（インストール後で可能）
    ※ワークフロー右上の[χ]をクリックして設定
  4.スクリプトは設定できる値に合わせて修正が必要かも
    ※ちなみに私のエアコンは、NatureRemoで"Mitsubishi AC 209"として設定されていました

使い方：
　aircon（キーワード）とパラメータで制御
　例）
　　aircon（パラメータなし）　室温・湿度の表示
　　aircon　off　      　　 電源オフ
　　aircon　dry　          除湿オン
　　aircon　数字　          冷房オン（温度設定）


開発メモ：

1.NatureRemoのAPI

　URLでNatureRemoをコントロールできます
　Tokenの取得方法やAPIの詳細はインターネットで調べてください
　APIはcURLのPOSTで操作が可能ですのでターミナルで遊んでみてください

　Tokenは個々のNatureRemoへのアクセス用になるので、公開できない情報です
　（公開するとあなたの家電を第3者がコントロールできちゃいますよ）
　

2.export禁止変数

　tokenのような情報はexport禁止の変数として管理します
　ワークフロー右上の[χ]をクリックして環境変数の一覧を表示させてください
　インストール後には、valueが空欄になっていますので、ご自身のNatureRemoのトークンを貼り付けてください
　引用符は不要です

  またNatureRemoでは家電ごとにアプライアンスIDが割り当てられますが、
　今回対象のエアコンのIDもexport禁止変数としています。
　ご自身の環境のNatureRemoで情報を取得して設定してください。
　GET "https://api.nature.global/1/appliances" でアプライアンス（家電）情報が確認できます
　もち、トークンは必要です

3.スクリプトフィルターとキーワードのハイブリッド
　
　airconというキーワードインプットとScript Filterを同時に利用しています
　Script Filterは引数なしで、NatureRemoから室温と湿度を取得してAlfred出力に表示させます
　キーワードインプットは引数によって処理を振り分けています

　スクリプトフィルターとキーワードのハイブリッドの場合、どのようなフローにするのが最適なのかわかっていませんが
　いったん、ShowAlfredオブジェクトを利用して、ariconを再帰するように設定しています
　引数なしでエンターキーを押したときに途切れないようするためです
　

4.入力パラメータによって処理を分岐させる（conditionalユーティリティ）

　conditionalユーティリティを開いてみてください
　1行目の条件はパラメータがない状態を意味します（『is equal to』と『（空欄）』）
　なお『then』のあとのテキスト（『再表示』）はalfredワークフローをわかりやすくするための表示用文字列です
　ソースコードを書くような感じに見えますが勘違いしないようにご注意くださいね
　2行目は引数『off』、3行目は引数『dry』の場合の分岐です
　それ以外が全て冷房の処理になりますが、冷房温度の範囲のチェックはRunScriptで行っています



5.室温と湿度の取得

　NatureRemoのAPIで室温と湿度を取得しています
　created_atという項目があり、取得した日時があるので、サブタイルとして表示させてみました
　ちょっと遅れている時間でしたので、グリニッジ時刻なのかな
　ということでJST（日本時刻）に変換しています。
　興味があったらみてください。9時間補正の簡単な変換機能があるのですね。


6.エアコン操作

　3つのRunScriptでそれぞれエアコンの操作をしていますが、基本APIをcURLで呼んでいるだけです
　NatureRemoのAPIとにらめっこをして、カスタマイズしてみてください　
　

背景：
　はやくも夏日の声を聞くようになったので、エアコン操作をつくってみました
　Lesson10と18でTVのリモコンを実装しているので、操作部分は簡単でした
　一方でNatureRemoの携帯アプリをみると室温と湿度が表示されてたので、
　気になってAPIを見てみたら、案の定、情報があったので、Alfredで表示させてみました
　
　
